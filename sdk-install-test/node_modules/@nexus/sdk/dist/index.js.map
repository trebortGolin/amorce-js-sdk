{"version":3,"sources":["../src/index.ts","../src/exceptions.ts","../src/identity.ts","../src/envelope.ts","../src/client.ts"],"sourcesContent":["/**\n * Nexus SDK for JavaScript/TypeScript\n * Version 0.1.7\n * \n * Aligned with nexus-py-sdk v0.1.7\n */\n\nexport const SDK_VERSION = \"0.1.7\";\nexport const NATP_VERSION = \"0.1.0\";\n\n// Export Exception Classes\nexport * from './exceptions';\n\n// Export Identity Module (with Provider Pattern)\nexport * from './identity';\n\n// Export Envelope Module (Legacy/Future Use)\nexport * from './envelope';\n\n// Export Client Module\nexport * from './client';\n\nconsole.log(`Nexus JS SDK v${SDK_VERSION} loaded.`);","/**\n * Nexus Exceptions Module\n * Defines custom exceptions for the Nexus SDK to allow fine-grained error handling.\n * Matches the exception hierarchy from nexus-py-sdk v0.1.7\n */\n\n/**\n * Base class for all Nexus SDK exceptions.\n */\nexport class NexusError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = 'NexusError';\n        // Maintains proper stack trace for where our error was thrown (only available on V8)\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n    }\n}\n\n/**\n * Raised when there is a configuration issue (e.g. invalid URL, missing key).\n */\nexport class NexusConfigError extends NexusError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'NexusConfigError';\n    }\n}\n\n/**\n * Raised when a network operation fails (e.g. connection timeout, DNS error).\n */\nexport class NexusNetworkError extends NexusError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'NexusNetworkError';\n    }\n}\n\n/**\n * Raised when the Nexus API returns an error response (4xx, 5xx).\n */\nexport class NexusAPIError extends NexusError {\n    public statusCode?: number;\n    public responseBody?: string;\n\n    constructor(message: string, statusCode?: number, responseBody?: string) {\n        super(message);\n        this.name = 'NexusAPIError';\n        this.statusCode = statusCode;\n        this.responseBody = responseBody;\n    }\n}\n\n/**\n * Raised when a security-related operation fails (e.g. signing, key loading).\n */\nexport class NexusSecurityError extends NexusError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'NexusSecurityError';\n    }\n}\n\n/**\n * Raised when data validation fails (e.g. invalid envelope structure).\n */\nexport class NexusValidationError extends NexusError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'NexusValidationError';\n    }\n}\n","/**\n * Nexus Identity Module (Task 2.2 - Enhanced for v0.1.7)\n * Handles Ed25519 key management and signing using libsodium.\n * Compatible with both Browser and Node.js environments.\n * \n * v0.1.7 Updates:\n * - Added Provider Pattern for flexible key sources\n * - Added Agent ID derivation (SHA-256 of public key)\n * - Added canonical JSON helper\n * - Improved error handling with custom exceptions\n */\n\nimport sodium from 'libsodium-wrappers';\nimport { NexusSecurityError } from './exceptions';\n\n/**\n * Abstract base class for retrieving private keys.\n */\nexport interface IdentityProvider {\n  getPrivateKey(): Promise<Uint8Array>;\n}\n\n/**\n * Loads a private key from an environment variable string.\n * Works in both Node.js and browser environments (if env vars are available).\n */\nexport class EnvVarProvider implements IdentityProvider {\n  private envVarName: string;\n\n  constructor(envVarName: string = 'AGENT_PRIVATE_KEY') {\n    this.envVarName = envVarName;\n  }\n\n  async getPrivateKey(): Promise<Uint8Array> {\n    await sodium.ready;\n\n    // Try to get from process.env (Node.js) or globalThis (browser with webpack/vite)\n    let pemData: string | undefined;\n\n    if (typeof process !== 'undefined' && process.env) {\n      pemData = process.env[this.envVarName];\n    }\n\n    if (!pemData) {\n      throw new NexusSecurityError(`Environment variable ${this.envVarName} is not set.`);\n    }\n\n    // Handle cases where newlines are escaped (common in some CI/CD)\n    pemData = pemData.replace(/\\\\n/g, '\\n');\n\n    try {\n      return this.pemToPrivateKey(pemData);\n    } catch (e) {\n      throw new NexusSecurityError(`Failed to load key from environment variable: ${e}`);\n    }\n  }\n\n  private pemToPrivateKey(pem: string): Uint8Array {\n    // Extract base64 from PEM format\n    const b64 = pem\n      .replace('-----BEGIN PRIVATE KEY-----', '')\n      .replace('-----END PRIVATE KEY-----', '')\n      .replace(/\\s/g, '');\n\n    // Decode base64\n    const fullBytes = sodium.from_base64(b64, sodium.base64_variants.ORIGINAL);\n\n    // PKCS#8 format for Ed25519 has a 16-byte header, followed by 2-byte length prefix, then 32-byte key\n    // Total: 48 bytes (16 + 2 + 32), but we need to extract the 32-byte seed\n    if (fullBytes.length >= 48) {\n      // The seed starts at byte 16 (skip PKCS#8 header)\n      return fullBytes.slice(16, 48);\n    }\n\n    throw new NexusSecurityError('Invalid private key format');\n  }\n}\n\n/**\n * Holds a generated key in memory (Ephemeral).\n * Internal provider used by the generate() factory method.\n */\nclass InMemoryProvider implements IdentityProvider {\n  private privateKey: Uint8Array;\n\n  constructor(privateKey: Uint8Array) {\n    this.privateKey = privateKey;\n  }\n\n  async getPrivateKey(): Promise<Uint8Array> {\n    return this.privateKey;\n  }\n}\n\n/**\n * Central class to manage the agent's identity.\n */\nexport class IdentityManager {\n  private privateKey: Uint8Array;\n  public publicKey: Uint8Array;\n\n  private constructor(privateKey: Uint8Array, publicKey: Uint8Array) {\n    this.privateKey = privateKey;\n    this.publicKey = publicKey;\n  }\n\n  /**\n   * Initializes from a provider (flexible key source).\n   */\n  static async fromProvider(provider: IdentityProvider): Promise<IdentityManager> {\n    await sodium.ready;\n    const privateKey = await provider.getPrivateKey();\n\n    // Extract public key from private key\n    // The private key in libsodium is actually the seed (32 bytes)\n    // We need to generate the full keypair from it\n    const keypair = sodium.crypto_sign_seed_keypair(privateKey);\n\n    return new IdentityManager(keypair.privateKey, keypair.publicKey);\n  }\n\n  /**\n   * Factory method: Generates a new ephemeral Ed25519 identity in memory.\n   * Matches Python's IdentityManager.generate_ephemeral()\n   */\n  static async generate(): Promise<IdentityManager> {\n    await sodium.ready;\n    const keypair = sodium.crypto_sign_keypair();\n    return new IdentityManager(keypair.privateKey, keypair.publicKey);\n  }\n\n  /**\n   * Legacy method: Loads an identity from a raw private key (Uint8Array).\n   * Kept for backward compatibility.\n   */\n  static async fromPrivateKey(privateKey: Uint8Array): Promise<IdentityManager> {\n    await sodium.ready;\n    // Extract public key from private key\n    const publicKey = (sodium as any).crypto_sign_ed25519_sk_to_pk(privateKey);\n    return new IdentityManager(privateKey, publicKey);\n  }\n\n  /**\n   * Signs a message (string or bytes) and returns the signature in Base64.\n   */\n  async sign(message: string | Uint8Array): Promise<string> {\n    await sodium.ready;\n    const signature = sodium.crypto_sign_detached(message, this.privateKey);\n    return sodium.to_base64(signature, sodium.base64_variants.ORIGINAL);\n  }\n\n  /**\n   * Verifies a signature against a public key.\n   * Static utility for validation.\n   */\n  static async verify(\n    message: string | Uint8Array,\n    signatureBase64: string,\n    publicKey: Uint8Array\n  ): Promise<boolean> {\n    await sodium.ready;\n    try {\n      const signature = sodium.from_base64(signatureBase64, sodium.base64_variants.ORIGINAL);\n      return sodium.crypto_sign_verify_detached(signature, message, publicKey);\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Exports the Public Key to PEM format (PKIX).\n   * Matches Python's serialization.PublicFormat.SubjectPublicKeyInfo\n   */\n  getPublicKeyPem(): string {\n    // Ed25519 OID prefix for SubjectPublicKeyInfo\n    const prefix = new Uint8Array([\n      0x30, 0x2a, // Sequence, length 42\n      0x30, 0x05, // Sequence, length 5\n      0x06, 0x03, 0x2b, 0x65, 0x70, // OID: 1.3.101.112 (Ed25519)\n      0x03, 0x21, 0x00 // Bit String, length 33, 0 padding\n    ]);\n\n    const combined = new Uint8Array(prefix.length + this.publicKey.length);\n    combined.set(prefix);\n    combined.set(this.publicKey, prefix.length);\n\n    const b64 = sodium.to_base64(combined, sodium.base64_variants.ORIGINAL);\n\n    return `-----BEGIN PUBLIC KEY-----\\n${b64}\\n-----END PUBLIC KEY-----\\n`;\n  }\n\n  /**\n   * MCP 1.0: Deterministic Agent ID derivation.\n   * Returns the SHA-256 hash of the public key PEM.\n   * This ensures the ID is cryptographically bound to the key.\n   * Matches Python SDK behavior.\n   */\n  getAgentId(): string {\n    const cleanPem = this.getPublicKeyPem().trim();\n\n    // Try Node.js crypto first\n    if (typeof require !== 'undefined') {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\n        const crypto = require('crypto');\n        return crypto.createHash('sha256').update(cleanPem, 'utf-8').digest('hex');\n      } catch (e) {\n        // Fall through to manual implementation\n      }\n    }\n\n    // For browser environments, we'd need Web Crypto API\n    // For now, throw error as this is primarily for Node.js\n    throw new Error('Agent ID derivation requires Node.js crypto module');\n  }\n\n  /**\n   * Returns the canonical JSON byte representation for signing.\n   * Strict: sort_keys=True, no whitespace.\n   * Matches Python's get_canonical_json_bytes()\n   */\n  static getCanonicalJsonBytes(payload: any): Uint8Array {\n    // Use the same stable stringify as envelope.ts\n    const stringify = require('fast-json-stable-stringify');\n    const jsonStr = stringify(payload);\n    return new TextEncoder().encode(jsonStr);\n  }\n}","/**\n * Nexus Envelope (Task 2.3 - Updated for v0.1.7)\n * Defines the strict NATP v0.1 data structure.\n * Handles canonical serialization and signing.\n * \n * v0.1.7 Updates:\n * - Enhanced error handling with custom exceptions\n * - Better validation\n * \n * NOTE: This module is kept for potential future use and backward compatibility.\n * The current transaction protocol (v0.1.7) uses a flat JSON structure instead\n * of wrapping everything in an envelope.\n */\n\nimport stringify from 'fast-json-stable-stringify';\nimport { v4 as uuidv4 } from 'uuid';\nimport sodium from 'libsodium-wrappers';\nimport { IdentityManager } from './identity';\nimport { NexusValidationError } from './exceptions';\n\n// Define strict types for priority\nexport type NexusPriority = 'normal' | 'high' | 'critical';\n\nexport interface SenderInfo {\n  public_key: string; // PEM format\n  agent_id?: string;\n}\n\nexport interface SettlementInfo {\n  amount: number;\n  currency: string;\n  facilitation_fee: number;\n}\n\nexport class NexusEnvelope {\n  natp_version: string = \"0.1.0\";\n  id: string;\n  priority: NexusPriority;\n  timestamp: number;\n  sender: SenderInfo;\n  payload: Record<string, any>;\n  settlement: SettlementInfo;\n  signature?: string;\n\n  constructor(\n    sender: SenderInfo,\n    payload: Record<string, any>,\n    priority: NexusPriority = 'normal'\n  ) {\n    // Validate priority\n    if (!['normal', 'high', 'critical'].includes(priority)) {\n      throw new NexusValidationError(\n        `Invalid priority: ${priority}. Must be 'normal', 'high', or 'critical'.`\n      );\n    }\n\n    this.id = uuidv4();\n    this.priority = priority;\n    // Python uses float seconds, JS uses ms. Convert to seconds.\n    this.timestamp = Date.now() / 1000;\n    this.sender = sender;\n    this.payload = payload;\n    this.settlement = { amount: 0, currency: 'USD', facilitation_fee: 0 };\n  }\n\n  /**\n   * Returns the canonical JSON bytes of the envelope WITHOUT the signature.\n   */\n  public getCanonicalJson(): Uint8Array {\n    const { signature, ...dataToSign } = this;\n    // fast-json-stable-stringify produces compact JSON (no spaces),\n    // matching Python's separators=(',', ':')\n    const jsonStr = stringify(dataToSign);\n    return new TextEncoder().encode(jsonStr);\n  }\n\n  /**\n   * Signs the envelope using the provided IdentityManager.\n   */\n  public async sign(identity: IdentityManager): Promise<void> {\n    const bytes = this.getCanonicalJson();\n    this.signature = await identity.sign(bytes);\n  }\n\n  /**\n   * Helper to parse a PEM public key back to Uint8Array for verification.\n   * FIX: We must strip the ASN.1 header to get the raw Ed25519 key.\n   */\n  private static pemToBytes(pem: string): Uint8Array {\n    // 1. Clean up the PEM string\n    const b64 = pem\n      .replace('-----BEGIN PUBLIC KEY-----', '')\n      .replace('-----END PUBLIC KEY-----', '')\n      .replace(/\\s/g, '');\n\n    // 2. Decode Base64\n    const fullBytes = sodium.from_base64(b64, sodium.base64_variants.ORIGINAL);\n\n    // 3. Strip ASN.1 Header (Fix)\n    // The SubjectPublicKeyInfo format is 44 bytes total (12 bytes header + 32 bytes key).\n    // Libsodium only wants the raw 32 bytes.\n    if (fullBytes.length > 32) {\n      return fullBytes.slice(fullBytes.length - 32);\n    }\n\n    return fullBytes;\n  }\n\n  /**\n   * Verifies the envelope's signature against its own sender public key.\n   */\n  public async verify(): Promise<boolean> {\n    if (!this.signature) {\n      throw new NexusValidationError('Envelope has no signature');\n    }\n\n    await sodium.ready;\n\n    try {\n      const canonicalBytes = this.getCanonicalJson();\n      const publicKeyBytes = NexusEnvelope.pemToBytes(this.sender.public_key);\n\n      return IdentityManager.verify(canonicalBytes, this.signature, publicKeyBytes);\n    } catch (e) {\n      throw new NexusValidationError(`Verification failed: ${e}`);\n    }\n  }\n}\n\n// DX ALIAS: For simpler imports\nexport const Envelope = NexusEnvelope;","/**\n * Nexus Client Module (Task 2.4 - Updated for v0.1.7)\n * High-level HTTP client for the Nexus Agent Transaction Protocol (NATP).\n * Encapsulates signature creation and transport using fetch with retry logic.\n * \n * v0.1.7 Updates:\n * - Flat transaction protocol (signature in header, not wrapped in envelope)\n * - Auto-derived Agent ID from identity\n * - Proper exception handling\n * - Updated API key header to X-API-Key\n * - URL validation\n */\n\nimport { IdentityManager } from './identity';\nimport { NexusPriority } from './envelope';\nimport { NexusConfigError, NexusNetworkError, NexusAPIError } from './exceptions';\n// @ts-ignore: cross-fetch types can be tricky, ignore if implicit\nimport originalFetch from 'cross-fetch';\n// @ts-ignore: fetch-retry usually lacks types or has conflict, we handle it manually\nimport fetchRetry from 'fetch-retry';\n\n// Wrap fetch with retry logic (Resilience v0.1.2+)\nconst fetch = fetchRetry(originalFetch as any);\n\n/**\n * Priority Level constants for easier developer access.\n * Matches Python SDK's PriorityLevel class.\n */\nexport class PriorityLevel {\n  static readonly NORMAL: NexusPriority = 'normal';\n  static readonly HIGH: NexusPriority = 'high';\n  static readonly CRITICAL: NexusPriority = 'critical';\n}\n\nexport interface ServiceContract {\n  service_id: string;\n  provider_agent_id: string;\n  service_type: string;\n  // ... other fields can be added as needed\n  [key: string]: any;\n}\n\nexport class NexusClient {\n  private identity: IdentityManager;\n  private directoryUrl: string;\n  private orchestratorUrl: string;\n  private agentId: string;\n  private apiKey?: string;\n\n  constructor(\n    identity: IdentityManager,\n    directoryUrl: string,\n    orchestratorUrl: string,\n    agentId?: string,\n    apiKey?: string\n  ) {\n    this.identity = identity;\n\n    // Validate URLs\n    if (!directoryUrl.startsWith('http://') && !directoryUrl.startsWith('https://')) {\n      throw new NexusConfigError(`Invalid directory_url: ${directoryUrl}`);\n    }\n    if (!orchestratorUrl.startsWith('http://') && !orchestratorUrl.startsWith('https://')) {\n      throw new NexusConfigError(`Invalid orchestrator_url: ${orchestratorUrl}`);\n    }\n\n    // Remove trailing slashes for consistency\n    this.directoryUrl = directoryUrl.replace(/\\/$/, '');\n    this.orchestratorUrl = orchestratorUrl.replace(/\\/$/, '');\n\n    // MCP 2.1: Read Agent ID directly from the identity derivation\n    this.agentId = agentId || identity.getAgentId();\n    this.apiKey = apiKey;\n  }\n\n  /**\n   * P-7.1: Discover services from the Trust Directory.\n   */\n  public async discover(serviceType: string): Promise<ServiceContract[]> {\n    const url = `${this.directoryUrl}/api/v1/services/search?service_type=${encodeURIComponent(serviceType)}`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        // Resilience Config\n        retries: 3,\n        retryDelay: (attempt: number) => Math.pow(2, attempt) * 1000 // 1s, 2s, 4s\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new NexusAPIError(\n          `Discovery API error: ${response.status}`,\n          response.status,\n          errorText\n        );\n      }\n\n      return await response.json();\n    } catch (e) {\n      if (e instanceof NexusAPIError) {\n        throw e;\n      }\n      throw new NexusNetworkError(`Discovery network error: ${e}`);\n    }\n  }\n\n  /**\n   * P-9.3: Execute a transaction via the Orchestrator.\n   * FIX: Aligned with Orchestrator v1.4 protocol (Flat JSON + Header Signature).\n   * Matches Python SDK's transact() method.\n   */\n  public async transact(\n    serviceContract: ServiceContract,\n    payload: Record<string, any>,\n    priority: NexusPriority = PriorityLevel.NORMAL\n  ): Promise<any> {\n    if (!serviceContract.service_id) {\n      throw new NexusConfigError('Invalid service contract: missing service_id');\n    }\n\n    // --- PROTOCOL ALIGNMENT ---\n    // 1. Build the flat JSON body expected by the server\n    const requestBody = {\n      service_id: serviceContract.service_id,\n      consumer_agent_id: this.agentId,\n      payload: payload,\n      priority: priority\n    };\n\n    // 2. Sign this exact JSON\n    const canonicalBytes = IdentityManager.getCanonicalJsonBytes(requestBody);\n    const signature = await this.identity.sign(canonicalBytes);\n\n    // 3. Put the signature in the header\n    const headers: Record<string, string> = {\n      'X-Agent-Signature': signature,\n      'Content-Type': 'application/json'\n    };\n\n    // FIX: Use X-API-Key instead of X-ATP-Key to match Python SDK\n    if (this.apiKey) {\n      headers['X-API-Key'] = this.apiKey;\n    }\n\n    const url = `${this.orchestratorUrl}/v1/a2a/transact`;\n\n    try {\n      // 4. Send with Auto-Retry (Resilience)\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify(requestBody),\n        // Retry Strategy: 3 attempts, exponential backoff\n        retries: 3,\n        retryOn: [500, 502, 503, 504, 429], // Retry on server errors & rate limits\n        retryDelay: (attempt: number) => Math.pow(2, attempt) * 1000 // 1s, 2s, 4s\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new NexusAPIError(\n          `Transaction failed with status ${response.status}`,\n          response.status,\n          errorText\n        );\n      }\n\n      return await response.json();\n    } catch (e) {\n      if (e instanceof NexusAPIError) {\n        throw e;\n      }\n      throw new NexusNetworkError(`Transaction network error: ${e}`);\n    }\n  }\n}"],"mappings":"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","names":["sodium","sodium","stringify","import_libsodium_wrappers","uuidv4","stringify","sodium","fetchRetry","originalFetch"]}